---
interface NavItem {
  label: string;
  href: string;
}

interface Props {
  navLinks: NavItem[] | [string, string][];
  lang?: "en" | "fa";
}

function normalizeNavLinks(raw: Props["navLinks"]) {
  return raw.map((item) => {
    if (Array.isArray(item)) return { label: item[0], href: item[1] };
    return item as NavItem;
  });
}

const { navLinks, lang = "en" } = Astro.props as Props;
const isFA = lang === "fa";

const links = normalizeNavLinks(navLinks);

// normalize current path
const current = Astro.url.pathname.replace(/\/+$/, "") || "/";
---

<script src="/scripts/nav-effects.js" defer></script>


<header
  class={[
    "fixed top-3 left-0 right-0 z-50",
    "text-neutral-700 dark:text-white font-medium tracking-tight",
    "transition-color-scale duration-500 ease-in-out select-none",
    isFA && "direction-rtl text-right",        // RTL fix
  ].join(" ")}
>
  <nav
    data-main-nav
    class={[
      "relative justify-self-center flex items-center justify-center h-[3.1rem]",
      "px-[clamp(0.6rem,1.5vw,1.5rem)] max-w-[900px] w-full rounded-full",
      "bg-[rgba(250,250,250,0.15)] hover:bg-white/30 dark:hover:bg-black/30",
      "backdrop-blur-xl shadow-lg shadow-black/10",
      "transition-all duration-300 ease-in-out min-w-0 overflow-hidden",
      isFA && "flex-row-reverse",              // RTL fix
    ].join(" ")}
    aria-label="Main Navigation"
  >
    <ul
      class={[
        "flex justify-center items-center flex-nowrap",
        "gap-[clamp(0.3rem,1.2vw,2rem)] list-none m-0 p-0",
        isFA && "flex-row-reverse",            // RTL fix
      ].join(" ")}
    >
      {links.map(({ label, href }) => {
        const normalized = href.replace(/\/+$/, "") || "/";
        const isActive = current === normalized;

        return (
          <li class="shrink">
            <a
              href={href}
              data-nav-link
              data-text={label}
              class={[
                "relative inline-block px-[clamp(0.4rem,0.8vw,0.8rem)] py-1",
                "transition-all duration-300 ease-out",
                "text-neutral-700 dark:text-white",

                // underline
                "after:absolute after:left-1/2 after:-bottom-1 after:w-0 after:h-0.5",
                "after:rounded-full after:bg-linear-to-r after:from-blue-400 after:to-purple-400",
                "after:transition-all after:duration-400 after:ease-out",

                // hover
                "hover:text-white hover:after:w-2/3 hover:after:-translate-x-1/2 hover:scale-125",

                // glitch
                "glitch-strong",

                // active
                isActive &&
                  "text-white scale-110 after:w-2/3 after:-translate-x-1/2 hover:scale-125",
              ]
                .filter(Boolean)
                .join(" ")}
            >

              {isFA ? (
                /* FA MODE â€” full word (ligature-safe), keeps animations */
                <span class="wave-fa">{label}</span>
              ) : (
                /* EN MODE â€” letter wave animation preserved */
                <span class="wave">
                  {label.split("").map((char, i) => (
                    <span class="wave-letter" style={`--i:${i}`}>{char}</span>
                  ))}
                </span>
              )}

            </a>
          </li>
        );
      })}
    </ul>
  </nav>
</header>

<style>
/* EN wave animation */
.wave {
  display: inline-flex;
}
.wave-letter {
  display: inline-block;
  transition: transform 0.2s ease, color 0.3s ease;
}

/* Persian: full-word, no breaking */
.wave-fa {
  display: inline-block;
}
</style>


<style>
.wave {
  display: inline-flex;
}

.wave-letter {
  display: inline-block;
  transition: transform 0.2s ease, color 0.3s ease;
}

/* ðŸŒŠ Forward wave (default, triggered by JS) */
.wave-active .wave-letter {
  animation: wave-up 0.75s ease forwards;
  animation-delay: calc(var(--i) * 90ms);
}

/* ðŸ”„ Reverse wave (triggered by JS on mouseleave) */
.wave-reverse .wave-letter {
  animation: wave-down 0.75s ease forwards;
  animation-delay: calc(var(--i) * 90ms);
}

/* ðŸ’« Double wave (optional mode: forward â†’ backward)
   you can trigger by adding class="wave-double"
*/
.wave-double .wave-letter {
  animation: wave-double 1.2s ease forwards;
  animation-delay: calc(var(--i) * 100ms);
}

/* ðŸŒˆ Color shifting during wave */
.wave-active .wave-letter,
.wave-reverse .wave-letter,
.wave-double .wave-letter {
  color: var(--wave-color, #7dd3fc); /* default cyan glow */
}

@keyframes wave-up {
  0%   { transform: translateY(0); color: inherit; }
  40%  { transform: translateY(-6px); color: #60a5fa; }  /* blue-ish */
  60%  { transform: translateY(0); }
  100% { transform: translateY(0); color: inherit; }
}

@keyframes wave-down {
  0%   { transform: translateY(0); color: inherit; }
  40%  { transform: translateY(6px); color: #a78bfa; }  /* purple-ish */
  60%  { transform: translateY(0); }
  100% { transform: translateY(0); color: inherit; }
}

/* Forward â†’ Backward */
@keyframes wave-double {
  0%   { transform: translateY(0) }
  25%  { transform: translateY(-6px) }
  50%  { transform: translateY(0) }
  75%  { transform: translateY(6px) }
  100% { transform: translateY(0) }
}
.wave-letter.spin-blur {
  filter: blur(1.2px);
  opacity: 0.75;
  transition: filter 120ms, opacity 120ms;
}

@media (max-width: 768px) {
  [data-main-nav] {
    opacity: 0;
    transform: scale(0.9);
    pointer-events: none;
    visibility: hidden;
  }
}



</style>
