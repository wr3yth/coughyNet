<button
  id="lang-toggle"
  class="relative flex items-center justify-center w-10 h-10 rounded-full
         hover:bg-white/20 transition-all duration-300 drop-shadow-xs/30 hover:scale-110"
  aria-label="Toggle language"
  title="Change language"
>
  <!-- EN icon -->
  <span
    id="icon-en"
    class="absolute text-sm font-bold transition-all duration-500"
  >
    فا
  </span>

  <!-- FA icon -->
  <span
    id="icon-fa"
    class="absolute text-sm font-bold transition-all duration-500"
  >
    en
  </span>
</button>

<script is:inline>
  ;(() => {
    const urlLang = location.pathname.startsWith("/fa") ? "fa" : "en";

    // THE REAL FINAL SOURCE OF TRUTH
    const lang = urlLang;

    const css = `
      #icon-en {
        opacity: ${lang === "en" ? "1" : "0"};
        transform: ${lang === "en" ? "scale(1)" : "scale(0.5)"};
      }
      #icon-fa {
        opacity: ${lang === "fa" ? "1" : "0"};
        transform: ${lang === "fa" ? "scale(1)" : "scale(0.5)"};
      }
    `;
    const tag = document.createElement("style");
    tag.innerHTML = css;
    document.head.appendChild(tag);
  })();
</script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.getElementById("lang-toggle")!;
    const iconEN = document.getElementById("icon-en")!;
    const iconFA = document.getElementById("icon-fa")!;

    const animateIcons = (toFA: boolean) => {
      iconEN.style.opacity = toFA ? "0" : "1";
      iconEN.style.transform = toFA ? "scale(0.5)" : "scale(1)";

      iconFA.style.opacity = toFA ? "1" : "0";
      iconFA.style.transform = toFA ? "scale(1)" : "scale(0.5)";
    };

    btn.addEventListener("click", () => {
      const isFA = location.pathname.startsWith("/fa");
      let newPath;
    
      if (isFA) {
        // FA → EN
        newPath = location.pathname.replace(/^\/fa/, "") || "/";
        localStorage.setItem("lang", "en");
      } else {
        // EN → FA
        newPath = "/fa" + (location.pathname === "/" ? "" : location.pathname);
        localStorage.setItem("lang", "fa");
      }
    
      window.location.href = newPath;
    });
  });
</script>

