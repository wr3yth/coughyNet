---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import { formatDate } from "../../../utils/formatDate";

const stories = await getCollection("storiesFa");

// Sort newest â†’ oldest
stories.sort((a, b) => {
  const da = new Date(a.data.date || 0);
  const db = new Date(b.data.date || 0);
  return db - da;
});
---

<BaseLayout lang="fa">

  <main class="px-6 py-20 max-w-5xl mx-auto direction-rtl text-right">

    <!-- Title -->
    <h1 class="text-4xl font-bold mb-12">Ø¯Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§</h1>

    <!-- Responsive Grid -->
    <div 
      class="grid gap-10 sm:grid-cols-2 lg:grid-cols-3 
             auto-rows-[1fr] items-start"
    >
      {stories.map((story) => (
        <a
          href={`/pdf/${story.id}.pdf`}
          class="group block rounded-2xl overflow-hidden
                 bg-white/10 dark:bg-white/5 
                 border border-white/20 backdrop-blur-xl shadow-lg
                 hover:-translate-y-1 hover:shadow-2xl
                 transition-all duration-300"
        >

          <!-- Image Section (optional) -->
          {story.data.image ? (
            <div class="relative w-full h-full overflow-hidden">
              <img
                src={story.data.image}
                alt={story.data.title}
                class="w-full h-full mx-auto  rounded-lg shadow-md max-h-80 object-contain
                       group-hover:scale-105 transition-transform duration-500"
              />
            </div>
          ) : (
            <div 
              class="w-full h-48 bg-linear-to-br from-purple-600/20 
                     to-blue-600/20 flex items-center justify-center
                     text-5xl opacity-30"
            >
              ðŸ“˜
            </div>
          )}

          <!-- Text Section -->
          <div class="p-6">

            <!-- Story Title -->
            <h2 class="text-xl font-semibold mb-3 group-hover:opacity-80">
              {story.data.title}
            </h2>

            <!-- Description -->
            {story.data.description && (
              <p class="opacity-70 mb-3 text-sm leading-relaxed line-clamp-3">
                {story.data.description}
              </p>
            )}

            <!-- Date -->
            {story.data.date && (
              <p class="text-xs opacity-60 mt-auto">
                {formatDate(new Date(story.data.date), "fa")}
              </p>
            )}
          </div>

        </a>
      ))}
    </div>

  </main>

</BaseLayout>
