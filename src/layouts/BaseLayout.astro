---
import Background from "../components/Astrogen.astro";
import Header from "../components/Header.astro";
import SocialBar from "../components/SocialBar.astro";
import "../styles/global.css";


const {
  pageTitle,
  lang = "en",     // 'en' or 'fa'
  pageClass = "",  // optional page-specific classes
} = Astro.props;
---

<html lang={lang}  class="transition-none">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <slot name="head" />

    <!-- THEME: prevent FOUC -->
    <script is:inline>
      const saved = localStorage.getItem("theme");
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      const isDark = saved === "dark" || (!saved && prefersDark);
      if (isDark) document.documentElement.classList.add("dark");
    </script>

    <!-- Auto font switch based on language -->
    {lang === "fa" ? (
      <link
        rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap"
      />
    ) : (
      <link
        rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Noto+Serif&family=Noto+Sans+Symbols+2&display=swap"
      />
    )}

    <!-- Allow transitions only after page is ready -->
    <script is:inline>
      window.addEventListener("load", () => {
        document.documentElement.classList.remove("transition-none");
      });
    </script>
  </head>

  <body class={`min-h-screen ${lang === "fa" ? "font-[Vazirmatn]" : "font-[Noto_Serif]"} ${pageClass}`}>
    <Background />
    <Header lang={lang} />

    <!-- Main Page Container -->
    <main id="page-content" data-page-content class="relative z-10">
      {pageTitle && (
        <h1 class="text-4xl font-semibold mb-8 text-center"></h1>
      )}

      <slot />
    </main>

    <!-- Accessibility: inert when sidebar is open -->
    <script is:inline>
      document.addEventListener("DOMContentLoaded", () => {
        const content = document.getElementById("page-content");

        document.addEventListener("sidebar:open", () => {
          content.setAttribute("aria-hidden", "true");
          content.setAttribute("inert", "");
        });

        document.addEventListener("sidebar:close", () => {
          content.removeAttribute("aria-hidden");
          content.removeAttribute("inert");
        });
      });
    </script>

    <SocialBar lang={lang} />
  </body>
</html>
